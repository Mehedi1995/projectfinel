<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>European Energy Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .feature-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-radius: 10px;
            height: 100%;
        }
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .comparison-options {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e9ecef;
        }
        .tooltip-icon {
            color: #6c757d;
            cursor: help;
            margin-left: 5px;
            transition: color 0.2s;
        }
        .tooltip-icon:hover {
            color: #495057;
        }
        .form-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }
        .quick-action-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 10px;
            height: 100%;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
        }
        .quick-action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .btn-advanced {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        .btn-advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .data-source-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        .select2-container--bootstrap5 .select2-selection--multiple {
            border: 1px solid #ced4da;
            border-radius: 0.375rem;
            min-height: 42px;
        }
        .analysis-type-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
        }
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Hero Section -->
        <div class="hero text-center">
            <h1 class="display-4 fw-bold mb-3">ðŸ‡ªðŸ‡º European Energy Analytics</h1>
            <p class="lead mb-4">Renewable energy analysis powered by Eurostat data</p>
            <div class="data-source-badge d-inline-block">
                <i class="fas fa-database me-1"></i>
                Data Sources: nrg_ind_ren & nrg_bal_s
            </div>
        </div>

    
        <!-- Main Comparison Form -->
        <div class="form-section">
            <div class="card border-0">
                <div class="card-header bg-primary text-white rounded-top">
                    <h4 class="mb-0"><i class="fas fa-sliders-h me-2"></i> Energy Comparison</h4>
                </div>
                <div class="card-body p-4">
                    <form action="/dashboard" method="get" id="comparisonForm">
                        
                        <!-- Comparison Type Selection -->
                        <div class="comparison-options">
                            <h5 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Comparison Type</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="form-check card p-3 h-100">
                                        <input class="form-check-input" type="radio" name="comparison_type" 
                                               id="compare_countries" value="countries" checked>
                                        <label class="form-check-label fw-bold" for="compare_countries">
                                            <i class="fas fa-flag me-2"></i>Compare Countries
                                            <i class="fas fa-info-circle tooltip-icon ms-1" 
                                               data-bs-toggle="tooltip" 
                                               title="Analyze renewable energy performance across different European nations"></i>
                                        </label>
                                        <small class="text-muted mt-1">Compare energy trends between countries</small>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check card p-3 h-100">
                                        <input class="form-check-input" type="radio" name="comparison_type" 
                                               id="compare_energy_types" value="energy_types">
                                        <label class="form-check-label fw-bold" for="compare_energy_types">
                                            <i class="fas fa-bolt me-2"></i>Compare Energy Types
                                            <i class="fas fa-info-circle tooltip-icon ms-1"
                                               data-bs-toggle="tooltip"
                                               title="Compare different renewable energy sources and their adoption rates"></i>
                                        </label>
                                        <small class="text-muted mt-1">Analyze different renewable technologies</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Selection -->
                        <div class="row">
                            <!-- Countries Multi-Select -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-globe-europe me-2"></i>Select Countries</h6>
                                    </div>
                                    <div class="card-body">
                                        <select name="countries" class="form-select" multiple="multiple" id="countriesSelect" size="6">
                                            {% for country in countries %}
                                            <option value="{{ country }}" {% if loop.index <= 3 %}selected{% endif %}>
                                                {{ country }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <small class="text-muted mt-2 d-block">
                                            <i class="fas fa-info-circle me-1"></i>Select multiple countries for comparison (Ctrl+Click)
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Energy Types Multi-Select -->
                            <div class="col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-industry me-2"></i>Select Energy Types</h6>
                                    </div>
                                    <div class="card-body">
                                        <select name="energy_types" class="form-select" multiple="multiple" id="energyTypesSelect" size="6">
                                            {% for energy_type in energy_types %}
                                            <option value="{{ energy_type }}" selected>
                                                {{ energy_type }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                        <small class="text-muted mt-2 d-block">
                                            <i class="fas fa-info-circle me-1"></i>Choose specific energy types or compare all
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Advanced Analysis Options -->
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-calendar me-2"></i>Time Period</h6>
                                    </div>
                                    <div class="card-body">
                                        <select name="year" class="form-select" id="yearSelect">
                                            <option value="All">All Years (Trend Analysis)</option>
                                            {% for year in years %}
                                            <option value="{{ year }}">{{ year }}</option>
                                            {% endfor %}
                                        </select>
                                        <small class="text-muted mt-2 d-block">
                                            Choose "All Years" for trends or specific year for snapshot
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-chart-line me-2"></i>Analysis Type</h6>
                                    </div>
                                    <div class="card-body">
                                        <select name="analysis_type" class="form-select" id="analysisType">
                                            <option value="share">Percentage Share (%)</option>
                                            <option value="absolute">Absolute Values (GWh)</option>
                                        </select>
                                        <small class="text-muted mt-2 d-block">
                                            View as percentage of mix or absolute energy values
                                        </small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="fas fa-magic me-2"></i>Forecasting</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="form-check mb-2">
                                            <input class="form-check-input" type="checkbox" name="show_forecast" 
                                                   id="show_forecast" value="true">
                                            <label class="form-check-label fw-bold" for="show_forecast">
                                                Enable AI Forecasting
                                                <i class="fas fa-info-circle tooltip-icon ms-1"
                                                   data-bs-toggle="tooltip"
                                                   title="Add machine learning-based forecasts to trend analysis"></i>
                                            </label>
                                        </div>
                                        <select name="forecast_years" class="form-select" id="forecastYears">
                                            <option value="3">3 Year Forecast</option>
                                            <option value="5" selected>5 Year Forecast</option>
                                            <option value="10">10 Year Forecast</option>
                                        </select>
                                        <small class="text-muted mt-2 d-block">
                                            Ensemble model: Linear Regression + Random Forest
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-advanced btn-lg me-3">
                                <i class="fas fa-rocket me-2"></i>Generate Analysis Dashboard
                            </button>
                            
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-lightbulb me-1"></i>
                                    <strong>Pro Tip:</strong> Use forecasting with trend view for future energy insights
                                </small>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        

        <!-- Data Statistics -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card border-0">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-database me-2"></i>Dataset Overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3 mb-3">
                                <div class="stats-card">
                                    <h3 class="display-6 fw-bold">{{ stats.total_countries }}</h3>
                                    <p class="mb-0">European Countries</p>
                                    <small><i class="fas fa-globe-europe me-1"></i>Coverage</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card">
                                    <h3 class="display-6 fw-bold">{{ stats.data_years }}</h3>
                                    <p class="mb-0">Data Period</p>
                                    <small><i class="fas fa-calendar me-1"></i>Years</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card">
                                    <h3 class="display-6 fw-bold">{{ energy_types|length }}</h3>
                                    <p class="mb-0">Energy Types</p>
                                    <small><i class="fas fa-bolt me-1"></i>Renewable Sources</small>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="stats-card">
                                    <h3 class="display-6 fw-bold">{{ stats.avg_renewable }}%</h3>
                                    <p class="mb-0">Avg Renewable</p>
                                    <small><i class="fas fa-chart-line me-1"></i>Latest Year</small>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Data Sources:</strong> This application uses official Eurostat data from 
                                    <code>nrg_ind_ren</code> (Renewable Energy Indicators) and <code>nrg_bal_s</code> 
                                    (Energy Balance Sheets) datasets, processed through advanced data cleaning pipelines.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row mt-5">
            <div class="col-12 text-center">
                <hr>
                <p class="text-muted">
                    <small>
                        <i class="fas fa-code me-1"></i>
                        European Energy Analytics Platform â€¢ 
                        Powered by Flask & Plotly â€¢
                        Eurostat Data Integration
                    </small>
                </p>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        // Initialize tooltips and select2
        $(document).ready(function() {
            // Initialize Bootstrap tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
            
            // Initialize Select2
            $('#countriesSelect').select2({
                placeholder: "Select countries to compare...",
                allowClear: true,
                width: '100%',
                theme: 'bootstrap-5'
            });
            
            $('#energyTypesSelect').select2({
                placeholder: "Select energy types...",
                allowClear: true,
                width: '100%',
                theme: 'bootstrap-5'
            });

            // Show/hide forecast years based on checkbox
            $('#show_forecast').change(function() {
                $('#forecastYears').prop('disabled', !this.checked);
            }).change();

            // Update analysis type description
            $('#analysisType').change(function() {
                const type = $(this).val();
                const description = type === 'share' ? 
                    'Percentage of total energy mix' : 
                    'Absolute energy values in GWh';
                $(this).next('.text-muted').text(description);
            });

            // Add form validation
            $('#comparisonForm').on('submit', function(e) {
                const countries = $('#countriesSelect').val();
                const energyTypes = $('#energyTypesSelect').val();
                
                if (!countries || countries.length === 0) {
                    e.preventDefault();
                    alert('Please select at least one country for analysis.');
                    return false;
                }
                
                if (!energyTypes || energyTypes.length === 0) {
                    e.preventDefault();
                    alert('Please select at least one energy type for analysis.');
                    return false;
                }
                
                // Show loading state
                const submitBtn = $(this).find('button[type="submit"]');
                const originalText = submitBtn.html();
                submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Generating Dashboard...');
                submitBtn.prop('disabled', true);
                
                // Re-enable after 3 seconds (in case of error)
                setTimeout(() => {
                    submitBtn.html(originalText);
                    submitBtn.prop('disabled', false);
                }, 3000);
            });
        });

        // Quick selection functions
        function selectNordic() {
            const nordicCountries = ['Sweden', 'Denmark', 'Norway', 'Finland'];
            $('#countriesSelect').val(nordicCountries).trigger('change');
            $('#compare_countries').prop('checked', true);
            $('#show_forecast').prop('checked', true);
            $('#yearSelect').val('All');
            $('#comparisonForm').submit();
        }

        function selectSolarLeaders() {
            const solarCountries = ['Spain', 'Italy', 'Greece', 'Germany'];
            $('#countriesSelect').val(solarCountries).trigger('change');
            $('#energyTypesSelect').val(['Solar']).trigger('change');
            $('#compare_countries').prop('checked', true);
            $('#analysisType').val('share');
            $('#comparisonForm').submit();
        }

        function selectWindFocus() {
            const windCountries = ['Denmark', 'Germany', 'United Kingdom', 'Netherlands'];
            $('#countriesSelect').val(windCountries).trigger('change');
            $('#energyTypesSelect').val(['Wind']).trigger('change');
            $('#compare_countries').prop('checked', true);
            $('#analysisType').val('absolute');
            $('#comparisonForm').submit();
        }

        function enableForecast() {
            $('#show_forecast').prop('checked', true);
            $('#yearSelect').val('All');
            $('#forecastYears').val('5');
            $('#comparisonForm').submit();
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + Enter to submit form
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                $('#comparisonForm').submit();
            }
            
            // Escape to clear selections
            if (e.key === 'Escape') {
                $('#countriesSelect').val(null).trigger('change');
                $('#energyTypesSelect').val(null).trigger('change');
            }
        });

        // Add some visual feedback
        document.addEventListener('DOMContentLoaded', function() {
            // Animate stats cards on load
            const statsCards = document.querySelectorAll('.stats-card');
            statsCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.transform = 'scale(1)';
                    }, 300);
                }, index * 200);
            });
            
            // Add pulse animation to feature cards on hover
            const featureCards = document.querySelectorAll('.feature-card');
            featureCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.animation = 'pulse 0.5s ease-in-out';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.animation = 'none';
                });
            });
        });

        // Add CSS animation for pulse effect
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>